---
title: 
date: 2025-04-25
tags:
  - 1
status: 
links:
---
# 不変性とレイヤー化を前提にしたカプセル化とオブジェクトの関係について考えてみた
https://zenn.dev/levtech/articles/49d055eacdff90
## カプセル化の崩壊
### データ普遍性と副作用の排除...
> 不変性はオブジェクトの状態が一度定義されると変更されないことを意味し、副作用の排除は関数が外部状態に依存せず、同じ入力に対して一貫した出力を返すことを保証します。
- 外部状態ってまさにDBがそれだ。DBは状態を持ってしまうから
>これにより、オブジェクトの状態を変更するメソッドがなくなります。さらに、副作用を排除するため、DB呼び出しなどの外部状態との相互作用を伴うメソッドも制限されます。
- 書いてあるわ
>結果として、振る舞いと情報を一体化させるという意味でのカプセル化の重要性は相対的に低下します。
- これって、このデータ状態だったらこの振る舞いが許可されるみたいなやつのこと？

### レイヤ化によって...
>外部入出力を含む副作用は、一般的にアプリケーションのインフラストラクチャ層に隔離されます。これにより、ビジネスロジックが外部の状態に依存せずに再利用可能で、テストしやすいものになります。
- わかったような、わからんような
>このため、出力に紐づけられるドメイン層のデータはデータアクセス層に提供するために、外部公開する必要があり、情報隠蔽化が崩れます。
- ここでいう情報いんぺいってのは、プロパティをprivateにすることか。
>本来、カプセル化はデータとそれを操作する振る舞いを一体化し、外部からは公開されたメソッドを通じてのみアクセスを許すことで、内部の複雑さを隠蔽することを目指します。しかし、`HogeCalculator`は、状態を管理するよりも`calc`のような特定メソッドを実行するためのユーティリティとして機能しており、状態と振る舞いの一体化というカプセル化からずれてます。このクラスは実質的に関数的な処理を提供しているだけです。
- そうかも
>そのため、`calc`メソッドのようなものを実装するときに純粋関数を選択肢から外す理由はあまりないです。  
以下の`calc`関数はコンストラクタインジェクションをやめて、`calc`メソッドを純粋関数にしたものです。純粋関数の方が再利用性が良く、コードも簡単です。  
このように考えていったとき、振る舞いとデータの一体化という意味でのカプセル化のメリットは相対的に小さくなったと考えられます。
- なるほど。確かに純粋関数でいいね。カプセル化する意味がない

### オブジェクトのメソッドは...
> カプセル化が破れて情報隠蔽ができなくなった場合、メソッドはオブジェクトのプロパティを第一引数にした関数の糖衣構文と言えます。
- おもしれ〜〜〜〜

>この変換ができることから、振る舞いはオブジェクトの外に出すことが可能になり、メソッドがオブジェクト内にある必然性がなくなります。
- ふむ
	- けど、まあそうか、その振る舞い（関数）がどんなデータ状態であるかを規定してくれるから、そういう処理を書こうとしたらもうデータ状態は担保されるのか
	- けど、その名前のついたデータ状態に対して、振る舞いが定義されているというのは凝集性の面から見ると嬉しい気もする
	- このデータ状態はこういう振る舞いを許されているんだ！　というのがわかる
		- でそのデータ状態ってのがもう不変によって管理メリット低くなってるから、関数にしたらええんでないですかってことか
	- そうかも
		- けどもうちょい自分の頭で考えたいな、あんまり地図が描けてないなこれ

## カプセル化が破れた後...
### 型による意味づけ
>型によって何らかの意味を付与することはまだ重要と
- そうだね
### データ整合性を保つ
> オブジェクトがデータの整合性を確保することは、例外的にオブジェクトに求められる振る舞い
- はい
	- ここら辺と、ここまでに言われたことの区別ついてないかも

### ドットによるメソッド呼び出し
- メソッド呼び出ししやすい
- せやね

## カプセル化の崩壊をモデリングで解釈し直す
> オブジェクト指向で考えられていたデータ視点の分析だけではなく、振る舞い視点の分析も重要になっていきます。
- そうなんや、OOPはデータ視点なんや
### 振る舞い視点の...
> イベントストーミングは、業務プロセスやシステムの振る舞いを理解し、モデリングするための手法です。  
このアプローチは、業務ドメインのイベントを紙やステッカーに書き出して壁に貼り、それらのイベントをつなげて全体の流れを可視化します。
- フーム

## 業務アプリケーションのオブジェクトには一部の振る舞いがない
確かに
書類のアナロジー。。

## 感想
- なるほどだった
	- これもうちょいこう知識があるともうちょい深く読めそう。全体図がわからんままに確かに。とかいいながら読んでる。これは理解してない時の読み方だな
