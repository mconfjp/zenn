# コンピュータサイエンスのベトナム戦争

**著者:** Ted Neward  
**日付:** 2006年6月26日

転載許可元: "The Blog Ride, Ted Neward's Technical Blog"  
http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx

---

## はじめに

2年前、サンディエゴで開催されたマイクロソフトのTechEdで、私はカンファレンス後のイベントでHarry PiersonとClemens Vastersとの会話に参加していました。私たち3人が集まるといつものように、アーキテクチャのトピックが議論の最前線にありました。私たちの周りに群衆が集まり、即席の鳥の羽セッションになりました。オブジェクト/リレーショナルマッピング技術の話題が出て、その場で私は「**オブジェクト/リレーショナルマッピングはコンピュータサイエンスのベトナム戦争である**」というフレーズを初めて作りました。

その後、この発言の背後にある議論を詳しく説明してほしいという数多くの要望を受け、マイクロソフトがADO.NET 3.0における「エンティティサポート」について最近発表し、Java Persistence APIがEJB Entity BeansとJDOの両方の代替として受け入れられたことを考えると、まさにそれを行う時期だと思いました。

---

## 要約

米国史において、ベトナムほどアメリカ軍を悩ませる武力紛争はありません。現代アメリカ史における最も決定的な転換点を生み出すために、非常に多くの異なる要素が結集したため、素人がそれらを解きほぐそうとすることは不可能です。それでも、ベトナムの物語は基本的には単純なものです。

アメリカ合衆国は、単純でありながら不明確で矛盾する目標を持つ軍事プロジェクトを開始し、すぐに泥沼に巻き込まれました。それは2つの政府を倒しただけでなく（1つは合法的に、もう1つは武力によって）、少なくとも次の40年間、アメリカの軍事ドクトリンに深い傷跡を残しました。

月並みに聞こえるかもしれませんが、**オブジェクト/リレーショナルマッピングはコンピュータサイエンスのベトナム戦争です**。それは、良好に始まり、時間が経つにつれて複雑になり、やがてユーザーを、明確な境界点も、明確な勝利条件も、明確な出口戦略もないコミットメントに閉じ込める泥沼を表しています。

---

## 歴史

### 南インドシナの歴史

現在ベトナム、タイ、ラオス、カンボジアとして知られる南インドシナは、自治のための闘争の長い歴史を持っています。

- **フランス植民地支配前**: 中国からの地域的独立のための闘争
- **第二次世界大戦中**: 日本による征服
- **戦後**: 連合国による「解放」、フランスの植民地支配再開
- **1954年**: フランスの降伏、ジュネーブ平和協定によるベトナムの独立

しかし、世界的な圧力により、永続的な平和協定の代わりに一時的な解決策が作られました。17度線で国を分割し、以前は存在しなかった2つの国を作りました。1956年に国を再統一するための選挙が予定されていましたが、アメリカはこれらの選挙を通じてベトナム共産党にあまりにも多くの権力が与えられることを恐れました。

新しい国家である**南ベトナム**が誕生し、その最初の指導者は熱烈な反共産主義者である**ゴ・ディン・ジエム**でした。

### ケネディ政権

ジョン・F・ケネディがホワイトハウスに来る頃には、南ベトナムで事態が頂点に達していました。「1961年12月白書」では、軍事的、技術的、経済的援助の増加と大規模なアメリカの「顧問」の派遣が提案されました。

しかし、ケネディの顧問の何人かは増強に反対し、ベトナムを「**行き止まりの路地**」と呼びました。

正反対の2つの道に直面したケネディは中間の道を選びました。大規模なコミットメントでも完全撤退でもなく、限定的な解決を求め、援助を送りましたが大人数の軍隊は送りませんでした。この道は最初からほぼ運命づけられていました。

一連の戦略的失敗を通じて、ジエムの支持は深く侵食され、ケネディはためらいながらクーデターを支持しました。その間にジエムは殺されました。3週間後、ケネディも暗殺されました。

### ジョンソンの戦争

ケネディ暗殺の時点で、ベトナムには16,000人のアメリカ人顧問が配置されていました。しかし、副大統領リンドン・ベインズ・ジョンソンは、より積極的な行動が必要だと信じるようになりました。

トンキン湾事件を利用して、ジョンソンは明示的な宣戦布告なしに軍事行動を行う権限を得ました。ジョンソンはこの戦争を「**冷血に**」戦いたかったのです。つまり、アメリカ国内の生活への影響を最小限に抑え、ベトナムでの出来事に気づくことなく続けることを目指しました。

しかし、歴史はこれを「**ジョンソンの戦争**」と呼んでいます。

当初、1967年の時点でアメリカ人は戦争が良いことだと確信していました。共産主義を阻止する必要があり、「**ドミノ理論**」が支配的でした。

しかし、**1968年のテト攻勢**がすべてを変えました。この攻撃は、アメリカ政府が戦争に勝っているというすべての保証に嘘をつきました。世論はジョンソンに背を向け、彼は再選を求めないと発表しました。

### ニクソンの約束

リチャード・ニクソンは「アメリカをベトナムから撤退させる」という約束で選挙運動を行いました。しかし、アメリカの交渉上の立場は深刻に弱体化していました。

北ベトナム軍/ベトコンの指導部は、見返りに何も提供することなくアメリカ人から譲歩を引き出すことができることを認識していました。

1973年、ニクソン政権は**パリ和平協定**に署名し、アメリカの関与を終了しました。

2年後、南ベトナムは制圧され、**1975年4月30日**、共産主義勢力がサイゴンを占領しました。最も記憶に残る画像は、大使館の屋上のヒューイヘリコプターに乗ろうとする逃げる人々の流れでした。

### 戦争の終わり

第二次南インドシナ戦争は終わり、アメリカはその歴史の中で最も深刻な敗北を経験しました。ベトナムは「**泥沼**」の同義語になりました。

**最終的な犠牲者数:**
- アメリカ人: 300万人が参戦、15万人が重傷、5万8千人が死亡、1,000人以上がMIA
- 北ベトナム軍/ベトコン軍: ほぼ100万人の犠牲者
- 南ベトナム: 25万人の犠牲者
- 民間人: 何十万人、あるいは何百万人もの犠牲者

---

## ベトナムの教訓

ベトナムは軍事および政治史の学生に興味深い問題を提示します。正確に何が、いつ、どこで間違ったのでしょうか？

- 軍事目標の欠如？ → いいえ、明確な目標はありました
- 軍事的失敗？ → いいえ、犠牲者数ではアメリカが勝っていました
- 軍隊を最大限に解き放たなかったこと？ → これも説明としては不十分

### 主要な失敗: 収穫逓減の法則

ベトナムの場合、アメリカは**収穫逓減の法則**の致命的な形に直面していました。

初期の成功が特定の行動方針へのコミットメントをもたらしましたが、時間の経過とともに、さらなる投資はますます相応しくない結果をもたらし、ますます危険な障害をもたらしました。その唯一の解決策は、より大きく大きなリソースのコミットメントであるように見えました。

これが「**滑りやすい坂道**」または「**薬物の罠**」と呼ばれるものです。

---

## ベトナムとO/Rマッピング

自動化されたオブジェクト/リレーショナルマッピングの場合も同じ懸念があります。

**初期の成功**がO/R-Mを使用する場所でのコミットメントをもたらし、時間の経過とともに成功がより困難になり、すべての可能なユースケースをサポートするために必要な時間とエネルギーのオーバーヘッドのために、まったく成功ではなくなります。

ベトナムの最大の教訓は、**「釣りをやめて逃げる」時期を知ること**です。

しかし、「ここまで来たのだから、きっとこれをやり遂げることができる」や「今後退することは、これまでに犠牲にしたすべてを捨てることだ」などのフレーズが一般的になります。

---

## オブジェクト-リレーショナルインピーダンスミスマッチ

### オブジェクトシステムの特徴

オブジェクトシステムは通常、4つの基本コンポーネントによって特徴付けられます:

1. **アイデンティティ**: オブジェクトの一意性（状態とは独立）
2. **状態**: 内部フィールドの値
3. **振る舞い**: クライアントが呼び出せる操作
4. **カプセル化**: 内部詳細の保護

これらから導き出される概念:
- **型**: 状態と振る舞いの正式な宣言
- **関連**: 型間の参照
- **継承**: 型間のIS-A関係
- **ポリモーフィズム**: 型の代替可能性

### リレーショナルシステムの特徴

リレーショナルシステムは述語論理と真理ステートメントに基づきます:

- **関係(Relation)**: 世界についての真理述語
- **属性(Attribute)**: 述語に意味を提供する事実
- **タプル(Tuple)**: 関係内の真理ステートメント
- **関係値**: 関係とタプルのセットの組み合わせ
- **関係変数**: 関係のプレースホルダー

例えば、関係「PERSON」を{SSN、Name、City}として定義できます。これは「社会保障番号SSNを持ち、Cityに住み、Nameと呼ばれるPERSONが存在する」ことを意味します。

### 基本的な違い

リレーショナル世界とオブジェクト世界は「適切な」設計について異なる見方をしています。

プログラマーがオブジェクト指向プログラミング言語を使用してリレーショナルデータストアにアクセスすることを好む限り、常に何らかの**オブジェクト-リレーショナルマッピング**が行われます。2つのモデルは単純に異なりすぎて静かに橋渡しすることはできません。

---

## O/Rマッピングの主要な問題

### 1. オブジェクト-テーブルマッピング問題

**最初は単純に見えます:**
- テーブル → 型
- 列 → フィールド
- VARCHAR → String、INTEGER → int

**しかし継承が問題を引き起こします:**

リレーショナルモデルは継承やIS-A関係をサポートしていません。開発者は3つのオプションのいずれかを採用する必要があります:

1. **クラスごとのテーブル**: 各クラスが独自のテーブルを持つ
   - 問題: 多数の高価なJOINが必要
   
2. **具象クラスごとのテーブル**: 最派生クラスのみにテーブルを作成
   - 問題: 重大な非正規化コスト
   
3. **クラスファミリーごとのテーブル**: 階層全体に単一のテーブル
   - 問題: 多くの空の列、NULL可能性制約

**関連の問題:**

オブジェクトシステムでは関連は単方向（関連子→被関連子）ですが、リレーショナルシステムでは逆転（被関連子→関連子、外部キーを介して）します。

### 2. スキーマ所有権の対立

多くのO/Rマッピングツールは、スキーマがO/R-Mのクエリ最適化のために定義できると想定しています。

**しかし現実は:**
- データベーススキーマはDBAグループによって所有されることが多い
- 他の部門がレポートを要求し始める
- スキーマは「凍結」される必要がある
- オブジェクトモデルのリファクタリングに対する障壁が作られる

### 3. デュアルスキーマ問題

O/R-Mソリューションでは、メタデータが2つの異なる場所に保持されます:
1. データベーススキーマ（DDL）
2. オブジェクトモデル（JavaまたはC#）

一方への更新は、他方への同様の更新を必要とします。データベースのリファクタリングは特に困難です（データの移行が必要）。

### 4. エンティティアイデンティティの問題

**オブジェクトシステム:**
- 暗黙のアイデンティティ（メモリ位置に基づく）
- 同じ状態の2つのオブジェクトは別々のオブジェクト

**リレーショナルシステム:**
- アイデンティティは状態に暗黙的
- まったく同じ状態の2つの行はデータ破損

**結果:**
- 両システムが合意するには、リレーショナルシステムは一意のアイデンティティ概念（通常は自動インクリメント整数列）を提供する必要がある
- キャッシングの問題: データアイデンティティがn+1の場所に分散（nはアプリケーションサーバーノード、1はデータベース）
- 並行性とトランザクション整合性の課題

### 5. データ取得メカニズムの懸念

純粋にオブジェクト指向のアプローチはコンストラクター構文を使用しますが、十分に柔軟ではありません。代わりに3つのアプローチが使用されます:

**Query-By-Example (QBE):**
```java
Person p = new Person();
p.LastName = "Smith";
ObjectCollection oc = QueryExecutor.execute(p);
```
- 問題: 複雑なクエリには不十分、null可能フィールドを強制

**Query-By-API (QBA):**
```java
Query q = new Query();
q.From("PERSON").Where(
  new EqualsCriteria("PERSON.LAST_NAME", "Smith"));
ObjectCollection oc = QueryExecutor.execute(q);
```
- 問題: SQLより冗長、「太い指」エラー（タイプミス）のリスク

**Query-By-Language (QBL):**
- OQL、HQLなどのSQL風言語
- 問題: SQLのサブセット、「オブジェクトのみ」のマントラを失う

### 6. 部分オブジェクト問題とロード時間パラドックス

**ネットワークトラバーサルのコスト:**
- ローカルメソッド呼び出しと比較して3〜5桁の大きさ

**SQLでの最適化:**
- 必要な列のみを取得
- ドリルダウンUIでは段階的にデータを取得

**O/Rレイヤーの問題:**
- オブジェクトは「一部」だけを返すことができない
- すべてのフィールドが存在する必要がある

**3つの不快な選択肢:**
1. null可能フィールドを許可（ドメイン制限に違反）
2. すべてのデータで完全に埋められたオブジェクトを返す（帯域幅の無駄）
3. オンデマンドロード（遅延ロード）を提供

**遅延ロードの問題:**
- N+1クエリ問題のリスク
- 関連オブジェクトの取得タイミングの決定が困難

---

## 可能な解決策

### 1. 放棄

開発者はオブジェクトを完全に諦め、オブジェクト/リレーショナルインピーダンスミスマッチを作成しないプログラミングモデルに戻ります。

- オブジェクトがなければインピーダンスミスマッチもない
- 特定のシナリオでは、オブジェクト指向アプローチのROIが不十分

### 2. 全面的な受け入れ

開発者はリレーショナルストレージを完全に諦め、オブジェクトストレージシステムを使用します。

- 例: db4oプロジェクト
- オブジェクトを直接ディスクに保存
- 「第2のスキーマ」がない
- サービス指向アーキテクチャでは実現可能

### 3. 手動マッピング

開発者は手動でリレーショナルアクセスコードを書き、必要に応じてオブジェクトを入力します。

- 多くの場合、データベースメタデータを調べるツールによって自動生成可能
- 「書くべきコードが多すぎる」という批判を排除

### 4. O/R-M制限の受け入れ

開発者はO/R-Mを使用して問題の80%（または50%、95%）を解決し、残りはSQLとリレーショナルベースのアクセスを使用します。

- 実用的なアプローチ
- ただし、キャッシングの認識が必要

### 5. 言語へのリレーショナル概念の統合

リレーショナル概念（セットベース）を主流のプログラミング言語に持ち込みます。

- 例: Scala、F#、LINQ（C#およびVisual Basic用）
- 「セット」と「オブジェクト」の間のギャップを埋める
- SQL/Jは失敗した試み

### 6. フレームワークへのリレーショナル概念の統合

よりリレーショナルな性質を持つ「オブジェクト」の異なるビューを取ります。

- オブジェクトがRowSet/DataSetインスタンスにデータを保持
- リレーショナル構造を中心に構築されたドメインフレームワーク

---

## 結論

ベトナムで、アメリカが明確な戦略を維持し、コミットメントと結果（ROI）の間のより明確な関係を理解していれば、ある程度の「成功」を達成できた可能性があります。

同様に、オブジェクト/リレーショナル問題は、**自分自身の限界を明確に認識している戦略の慎重かつ賢明な適用**によって「勝つ」ことができる可能性があります。

### 重要な教訓

開発者は:
- 「勝利」を得ることができる場所でそれを喜んで受け入れる必要がある
- **滑りやすい坂道のわな**に陥らないようにする必要がある
- ますます多くのコストをかけてますます少ない収益を生み出すソリューションを作成しようとしないこと

### 警告

ベトナム戦争の歴史が示すように、滑りやすい坂道の危険性を認識していても、泥沼に行き詰まることを避けるのに十分ではないことがよくあります。

さらに悪いことに、O/R-Mは**魅力的すぎて見逃せない泥沼**です。マイクロソフト、IBM、オラクル、サンなどを含むあらゆる規模の企業からの開発チームを岩に引き寄せ続ける**サイレンの歌**です。

**歌を聞きたい場合は自分をマストに縛り付けてください。しかし、船員に漕がせてください。**

---

## 参考文献

- **[Fussell]**: Foundations of Object Relational Mapping, by Mark L. Fussell, v0.2 (mlf-970703)
- **[Fowler]**: Patterns of Enterprise Application Architecture, by Martin Fowler
- **[Date04]**: Introduction to Database Systems, 8th Edition, by Chris Date
- **[Neward04]**: Effective Enterprise Java

---

*翻訳注: この論文は2006年に書かれたものであり、当時の技術状況を反映しています。現代のORMツールや言語機能は、ここで述べられている問題の一部を改善していますが、基本的な「インピーダンスミスマッチ」の問題は依然として存在します。*