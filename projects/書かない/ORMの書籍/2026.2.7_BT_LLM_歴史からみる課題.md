# 元ネタ

## 企画
- 永続化レイヤー抽象化の課題を概観する
	- 軽くジャブとして概観してもいいけど
- 歴史を知ることで、その課題がどんな前提に立っているのかわかる。現代の課題を見る上でも、前提を意識できるのでGood
	- これなんかもっと言い方あるな
- 楽しいのでやる
## 構成
- これどこから始めようかな
	- 1880年代は、むかしすぎる
		- ここはコラム程度にしたい
	- たぶんソフトウェアが出てきてから
		- RDBが出てきてからだろな
- なので、
	- データベースの誕生
	- OOPの誕生
	- 大規模データの登場
	- win95
	- OSSの時代
	- Webの時代
	- 現代
- って感じかなあ
- んでコラム
	- "ハードな"ソフトウェアの時代
## 本文
- ではここから、人類がどのように永続化レイヤーの抽象化に挑んできたのかを、歴史を遡って見ていきたいと思います。ここではコンピュータ科学とアメリカ産業史を振り返ります。
- コラム
	- 今回はRDBに対する抽象化を扱いますが、本来永続化レイヤーはたくさんあります。紙や石板、パンチカード、テキストファイル、階層データベースやNoSQLもそうです
- 節: ソフトウェアとRDBの登場
	- ではまずソフトウェアとデータベースの登場から見ましょう
	- 現代のソフトウェアは1950年代冷戦期のアメリカで生まれました
		- ソ連の長距離ミサイル開発によりアメリカの防空システムが危機に瀕して、対策としてSAGE防空システムが作られた
		- 当時アメリカにいたソフトウェアエンジニアの7割くらいがこれにかかわり、「ソフトウェアエンジニアの大学」と呼ばれた
		- この時期の永続化は磁気ドラムや磁気テープで実現されている
			- 要出典
		- 1959にデータバンクという言葉が初めて出てくる
			- 一箇所で管理すると便利！　そらそうだろとおもうけど、これが革命的だったわけ
	- もう少し時代が降り1960年台はソフトウェア危機の時代。ダイクストラとかブルックスがでてくるような時代
		- この時代にタイムシェアリングシステムが出てくる。単一のコンピューターを複数ユーザーが同時に使える技術
		- 複数ユーザーが単一リソースを触るわけだから、データ管理は複雑化する。整合性や同時アクセス制御の話、永続化するかどうかの話
	- 1960年代はデータベースの黎明期でもある
		- 階層型データベースやらネットワーク型データベースが出てきてる
		- 階層型はCOBOLのシステムとかでいまでも残ってる
			- 物理ポインタでデータを保存する。いくつめになにが入ってるとか
			- すごく帳票的な考え方。パンチカードそのもの。パンチカードを集計してつぎのパンチカードにのせてる
			- もりたは元々COBOLエンジニアなので気持ちが分かるぞ😊
	- 1970年代のアプリケーション
		- アプリケーションはここらへんからOOP登場する。1972年にパロアルト研究所のアラン・ケイがsmalltalkの開発開始
	- 1970年代のデータベース
		- 1970年にコッド博士がリレーショナルデータベースの提唱。『Communications of the ACM』に「ARelational Model of Data for Large Shared Data Banks」を書く
		- こいつは70年代をとおしてIBMが実用化を目指す
		- しかし初めて商用RDBとして実用化するのはOracleのOracle2
			- IBMが日和ってたから先に出した、とオラクルの人が言ってる
			- 「私たちは、IBMが自社の既存のIMS顧客を保護するために、リレーショナル技術の商用化を意図的に遅らせていると考えていた。これは私たちにとって絶好の機会だった」
			- IBMは階層型データベースで圧倒的なシェア
		- 1983年にIBMもDB2をリリース
			- COBOLとの相性が良く、EmbeddedSQLという技術でやってる
			- プログラム内にSQLを直接埋め込めた
			- これはすごいこと
				- ？それ以前は？？
	- 1980年代
		- GUIが発展した
	- 1990年代
		- IBMがSmalltalk移行プロジェクトをはじめた
		- win95
		- 1995年にJavaの登場
	- ORMの登場
		- 1994にTopLink for Smalltalk
			- 初めてのやつ
		- 1995年にMySQLのリリース
		- 1996年にTopLink for Java
		- 2002年にOracleがToplink買収
			- 商用的な価値が高いと
		- 2003年にMySQL4系
			- ここでinnodbが出る。トランザクション制御とかがあって、ある程度現代的なRDBとなる
		- 2004年に初のOSS製ORMであるHibernate
			- いまでも現役
		- 他の言語でもORMがどんどんつくられる
			- 2006年のRuby on RailsとActiveRecord
			- Webフレームワークに標準装備される
- 現代
	- あります
	- 問題もあります
- コラム
	- 1950年代より前のやつ
		- ハードなソフトウェア
		- 1880年にアメリカの国勢調査で開発される。帳票のシステム。

# 生成先

## コンピュータ科学史とアメリカ産業史から振り返る永続化レイヤー抽象化の歴史

ではここから、人類がどのように永続化レイヤーの抽象化に挑んできたのかを、歴史を遡って見ていきたいと思います。ここではコンピュータ科学とアメリカ産業史を振り返ります。

:::message
今回はRDBに対する抽象化を扱いますが、本来永続化レイヤーはたくさんあります。紙や石板、パンチカード、テキストファイル、階層型データベースやNoSQLもそうです。RDB登場以前の歴史についてはコラムで触れます。
:::

### ソフトウェアとデータベースの登場（1950〜1970年代）

#### 現代ソフトウェアの誕生

現代のソフトウェアは1950年代、冷戦期のアメリカで生まれました。

ソ連の長距離ミサイル開発によりアメリカの防空システムが危機に瀕し、その対策としてSAGE防空システムが開発されました。このプロジェクトは中央オペレーティングシステムだけで25万行、補助ソフトウェアを含めると100万行に及ぶ巨大なものでした。当時まだ黎明期だったソフトウェアエンジニアという職業にとって、このプロジェクトは「ソフトウェアエンジニアの大学」と呼ばれるほど多くの技術者が参加し、人材育成の場となりました[^sage]。

[^sage]: 『コンピュータ200年史-情報マシーン開発物語-』p196

この時期の永続化は磁気ドラムや磁気テープで実現されていました。1959年には「データバンク」という言葉が初めて登場します。データを一箇所で管理するというアイデアは、現代から見れば当たり前に思えますが、当時は革命的な発想でした。

#### ソフトウェア危機とタイムシェアリング

1960年代はソフトウェア危機の時代でした。代表的な失敗例がIBMのSystem/360向けOS「OS/360」です。1962年に計画が始まり、1967年中頃に1年遅延して完了。費用は見積もりの4倍に膨らみ、多くの技術者がIBMを去り、数十個のバグを抱えたままのリリースとなりました。このプロジェクトに参加したフレデリック・P・ブルックス・ジュニアは、この経験をもとに後に『人月の神話』を著しています[^software-crisis]。

[^software-crisis]: 『コンピュータ200年史-情報マシーン開発物語-』p200

この時代にタイムシェアリングシステムが登場します。単一のコンピュータを複数ユーザーが同時に使える技術です。複数ユーザーが単一のリソースを触ることになるため、データ管理は複雑化しました。整合性の担保、同時アクセス制御、データの永続化方法——こうした課題への解決策が求められるようになったのです。この文脈で1965年にMulticsが開発され、OSという概念が生まれていきます。

#### データベースの黎明期

1960年代はデータベースの黎明期でもあります。この時期に登場したのは階層型データベースやネットワーク型データベースでした。

階層型データベースはCOBOLのシステムなどで今でも現役で動いています。物理ポインタでデータを保存する方式で、「何番目に何が入っている」という形でデータを管理します。これはパンチカードの延長にある考え方で、帳票を集計して次の帳票に載せるという、非常に帳票的な発想に基づいています。

#### リレーショナルデータベースの登場

1970年、エドガー・F・コッド博士がリレーショナルデータベースを提唱しました。『Communications of the ACM』誌に発表された論文「A Relational Model of Data for Large Shared Data Banks」は、データベースの歴史における転換点となりました。

IBMは1970年代を通じてこの理論の実用化を目指しましたが、最初に商用リレーショナルデータベースを実用化したのはOracleでした。1979年にOracle2がリリースされます[^oracle]。IBMが先行しなかった理由について、Oracleの関係者は次のように語っています。

> 私たちは、IBMが自社の既存のIMS顧客を保護するために、リレーショナル技術の商用化を意図的に遅らせていると考えていた。これは私たちにとって絶好の機会だった。

当時IBMは階層型データベース（IMS）で圧倒的なシェアを持っており、自社製品との競合を避けていたのです。

[^oracle]: Oracle2は1979年リリース。IBMのDB2は1983年リリース。

IBMも1983年にDB2をリリースします。DB2はCOBOLとの相性がよく、Embedded SQL（埋め込みSQL）という技術でプログラム内にSQLを直接記述できました[^embedded-sql]。

```cobol
EXEC SQL
    SELECT EMP_NAME
    INTO :WS-EMPL-NAME
    FROM EMPLOYEE
    WHERE EMP_ID = :WS-EMPID
END-EXEC.
```

[^embedded-sql]: 1982年にDB2 V1.1とともにプリコンパイラー（DSNHPC）が開発された。

### OOPとGUIの発展（1970〜1990年代）

#### オブジェクト指向プログラミングの誕生

アプリケーション側では、1970年代からオブジェクト指向プログラミング（OOP）が登場します。1972年、ゼロックスのパロアルト研究所でアラン・ケイらがSmalltalkの開発を開始しました[^smalltalk]。

[^smalltalk]: Smalltalkは1972年、1976年を経て、1980年にSmalltalk-80として公開された。

しかしOOPはすぐには普及しませんでした。1970年代にはSimula67などがありましたが、主流は構造化プログラミングでした。1980年代に入ってもSmalltalkは存在していましたが、当時のビジネスアプリケーションはバッチ処理が中心であり、OOPの真価を発揮する場面が限られていました。COBOLはバッチ処理には適していましたが、ボタン押下のようなイベント駆動には対応できなかったのです。

#### GUIとOOPの関係

1969年、当時ユタ大学の大学院生だったアラン・ケイは博士論文で「リアクティブ・エンジン」という装置について言及しています。これが後のダイナブック構想となります。アラン・ケイは1970年からSmalltalkを開発しましたが、これは単なるプログラミング言語ではなく、オブジェクトベースのOSライクなソフトウェアであり、GUI的なインターフェースを持っていました[^kay]。

[^kay]: Smalltalkはゼロックスのワークステーション「Alto」向けのOSとして作られた。https://ok2nd.sakura.ne.jp/xerox-star/

つまり、OOPとGUIは同じ人物から生まれた双子のような存在です。Windows 95以降でOOPが爆発的に普及したのは、偶然ではなく必然だったのです。

#### Windows 95とOOPの普及

1984年にMacintoshが登場しましたが、一般への普及は限定的でした。OOPが商用的に爆発的に普及したのは1995年のWindows 95からです。同年にはJavaも登場し、Smalltalkに代わってOOP言語の主流となっていきます。

### ORMの登場（1990〜2000年代）

#### 最初のORM

OOPの普及により、オブジェクト指向で設計されたアプリケーションとリレーショナルデータベースの間に「インピーダンスミスマッチ」と呼ばれる問題が顕在化しました。オブジェクトの階層構造や継承関係を、テーブルの行と列にどう対応させるか——この課題を解決するために生まれたのがORMです。

最初のORMは1994年にリリースされたTopLink for Smalltalkでした[^toplink]。そして1996年にはTopLink for Javaがリリースされます。当時、エンタープライズ向け製品はライセンス料金で収益を上げるビジネスモデルが主流であり、TopLinkも商用製品として提供されていました。

[^toplink]: TopLinkは2002年にOracleに買収された。商用的な価値が高いと判断されたため。

#### OSSとORMの普及

2000年代に入ると、IT業界にオープンソースソフトウェア（OSS）の波が押し寄せます。

- 2003年：MySQL 4.0でInnoDBストレージエンジンが導入され、トランザクション制御が可能になり、ある程度現代的なRDBMSとなる
- 2004年：Hibernateがリリース（現在も現役のOSS製ORM）
- 2004年：PHP 5でオブジェクト指向対応が強化
- 2005年：PHPでもORMが登場
- 2006年：Ruby on RailsとActiveRecordが登場

特に2006年のRuby on Railsは、WebフレームワークにORMを標準装備するという形態を広め、ORMの普及を加速させました。以降、多くの言語・フレームワークでORMが当たり前の存在となっていきます。

### 現代

こうした歴史を経て、現代ではORMは広く普及しています。しかし同時に、ORMには固有の課題もあります。N+1問題、複雑なクエリの表現力、パフォーマンスチューニングの難しさ——これらの課題については、次章で詳しく見ていきます。

---

:::details コラム：1950年代より前の永続化——"ハードな"ソフトウェアの時代
コンピュータが登場する以前から、人類は永続化の課題に取り組んできました。

IBMの起源は19世紀末のアメリカ国勢調査にあります[^ibm]。移民の増加により、1880年の国勢調査は集計に7年もかかってしまいました。この問題を解決するために、ハーマン・ホレリスがパンチカードシステムを発案します。1896年にホレリスはTabulating Machines社を設立し、1911年に3社が合併してC-T-R（Computing-Tabulating-Recording Company）となり、1924年にInternational Business Machines（IBM）と改称されました。

[^ibm]: https://www.ibm.com/jp-ja/about 、https://ja.wikipedia.org/wiki/IBM

1928年には80列のパンチカードが導入され、世界的なデータ標準となります。パンチカードは物理的な穴の有無でデータを表現する、まさに「ハードな」ソフトウェアでした。階層型データベースの設計思想——物理ポインタでデータを保存し、何番目に何が入っているかを管理する——は、このパンチカード時代の考え方を色濃く受け継いでいます。
:::

