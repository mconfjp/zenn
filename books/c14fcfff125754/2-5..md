---
title: "2-５. 制限事項と既知の問題"
---

## 制限事項と既知の問題 (Limitations and known issues)

Prisma Migrateには、以下の制限事項が適用されます。

-----

### 1\. MongoDBコネクタは非対応 (MongoDB connector not supported)

Prisma Migrateは現在、**MongoDBコネクタをサポートしていません**。

-----

### 2\. データベースプロバイダーの自動切り替えは不可 (You cannot automatically switch database providers)

Prisma Migrateは、使用しているプロバイダー（データベースの種類）に**固有のSQLファイル**を生成します。

つまり、本番環境でPostgreSQL用、開発環境でSQLite用といったように、**同じマイグレーションファイルを異なるデータベースで使用することはできません**。これは、マイグレーション内の構文に互換性がないためです。

Prisma Migrateは、マイグレーションと構成されたプロバイダーが一致しない場合にエラーメッセージを出力します。

#### データベースプロバイダーを手動で切り替えるには

プロバイダーを手動で切り替えるには、以下の手順を実行する必要があります。

1.  `schema.prisma` の `datasource` ブロックで、`provider` と `url` パラメータを変更します。
2.  既存のマイグレーション履歴を**アーカイブまたは削除**します（`./prisma/migrations` フォルダを削除します）。
3.  **`prisma migrate dev`** を実行して、新しいマイグレーション履歴を開始します。

この最後のステップにより、空のデータベースから現在の `schema.prisma` に移行するための**新しい初期マイグレーション**が作成されます。以下の点に注意してください。

  * このマイグレーションには、`schema.prisma` に反映されているもののみが含まれます。以前のマイグレーションファイルに**カスタムSQL**を手動で追加していた場合は、**再度自分で追加する必要があります**。
  * 新しいプロバイダーを使用して新しく作成されたデータベースには、**データは含まれません**。

-----

### 3\. データベースのリセット時のデータ損失 (Data loss when resetting database)

開発環境では、Prisma Migrateからデータベースの**リセット**を促されることがあります。リセットはデータベースをドロップして再作成するため、**データが失われます**。

データベースがリセットされるのは、以下のいずれかの状況が発生したときです。

  * ユーザーが明示的に **`prisma migrate reset`** を呼び出したとき。
  * **`prisma migrate dev`** を呼び出したとき、Prisma Migrateが**データベースの乖離（drift）またはマイグレーション履歴の競合**を検出したとき。

> **注:** `prisma migrate dev` および `prisma migrate reset` コマンドは**開発環境でのみ**使用されるように設計されており、**本番データに影響を与えるべきではありません**。

データベースがリセットされると、`package.json` にシードスクリプトが検出された場合、**シード処理がトリガー**されます。

-----

### 4\. Prisma MigrateとPgBouncer (Prisma Migrate and PgBouncer)

PgBouncerを接続プールに使用している環境でPrisma Migrateコマンドを実行しようとすると、以下のエラーが発生することがあります。

```
Error: undefined: Database error
Error querying the database: db error: ERROR: prepared statement "s0" already exists
```

**対応:** PgBouncerを使用する際の回避策と詳細情報については、Prismaのドキュメントを参照してください。

-----

### 5\. 非対話型環境でのPrisma Migrate (Prisma Migrate in non-interactive environments)

Prisma ORMは、Docker、Nodeスクリプト、またはbashシェルなどの**非対話型環境**でCLIコマンドを実行すると、それを検出します。この場合、環境が非対話型であり、`migrate dev` コマンドがサポートされていないことを示す**警告が表示**されます。

`migrate dev` コマンドに反応するようにDocker環境を確保するには、イメージを**対話型モード**で実行してください。

```bash
docker run --interactive --tty <イメージ名>
# または
docker -it <イメージ名>
```