---
title: "3-1. Seedingï¼ˆãƒ‡ãƒ¼ã‚¿ã®åˆæœŸæŠ•å…¥ï¼‰"
---

# Seedingï¼ˆãƒ‡ãƒ¼ã‚¿ã®åˆæœŸæŠ•å…¥ï¼‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€**Prisma Client**ã¨**Prisma ORMã«çµ±åˆã•ã‚ŒãŸã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ©Ÿèƒ½**ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸæŠ•å…¥ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆSeedingï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§å¸¸ã«åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’**å†ç¾**ã§ãã€ä»¥ä¸‹ã®ç›®çš„ã§å½¹ç«‹ã¡ã¾ã™ã€‚

  * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã«**å¿…é ˆãªãƒ‡ãƒ¼ã‚¿**ï¼ˆä¾‹ï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨€èªã‚„é€šè²¨ï¼‰ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ã€‚
  * é–‹ç™ºç’°å¢ƒã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¤œè¨¼ãƒ»ä½¿ç”¨ã™ã‚‹ãŸã‚ã®**åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿**ã‚’æä¾›ã™ã‚‹ã€‚ã“ã‚Œã¯ã€é–‹ç™ºãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒªã‚»ãƒƒãƒˆãŒå¿…è¦ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹Prisma Migrateã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ç‰¹ã«ä¾¿åˆ©ã§ã™ã€‚

## ğŸ’¾ Prisma ORMã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚·ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•

Prisma ORMã«çµ±åˆã•ã‚Œã¦ã„ã‚‹ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ©Ÿèƒ½ã¯ã€`package.json` ãƒ•ã‚¡ã‚¤ãƒ«ã® `prisma` ã‚­ãƒ¼å†…ã«ã‚ã‚‹ `seed` ã‚­ãƒ¼ã«**ã‚³ãƒãƒ³ãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹**ã“ã¨ã‚’æœŸå¾…ã—ã¾ã™ã€‚`prisma db seed` ã‚³ãƒãƒ³ãƒ‰ã¯ã€å˜ã«ãã®å®šç¾©ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `prisma/` ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€ãã®ã‚³ãƒãƒ³ãƒ‰ã§èµ·å‹•ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### TypeScript ã®å ´åˆ

```json
"prisma": {
  "seed": "ts-node prisma/seed.ts"
}
```

> **â„¹ï¸ æƒ…å ±**
> TypeScriptã®å ´åˆã€`ts-node` ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã¨å‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™ã€‚å‹ãƒã‚§ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã«ã¯ã€`--transpile-only` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
> ä¾‹: `"seed": "ts-node --transpile-only prisma/seed.ts"`
> ã“ã‚Œã¯ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æ¸›ã‚‰ã—ã€ã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œé€Ÿåº¦ã‚’å‘ä¸Šã•ã›ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

### JavaScript ã®å ´åˆ

```json
"prisma": {
  "seed": "node prisma/seed.js"
}
```

-----

## ğŸ”— Prisma Migrateã¨ã®çµ±åˆã•ã‚ŒãŸã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯ã€Prisma ORMã§ã¯ä»¥ä¸‹ã®**2ã¤ã®æ–¹æ³•**ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

1.  **æ‰‹å‹•ã§** `prisma db seed` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
2.  `prisma migrate reset` ãŠã‚ˆã³ï¼ˆç‰¹å®šã®ã‚·ãƒŠãƒªã‚ªã§ã¯ï¼‰`prisma migrate dev` ã®å®Ÿè¡Œæ™‚ã«**è‡ªå‹•çš„ã«**å®Ÿè¡Œã•ã‚Œã‚‹ã€‚

`prisma db seed` ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ã„ã¤ã‚·ãƒ¼ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‚’å‘¼ã³å‡ºã™ã‹**ã‚’æ±ºå®šã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ†ã‚¹ãƒˆè¨­å®šã‚„æ–°ã—ã„é–‹ç™ºç’°å¢ƒã®æº–å‚™ãªã©ã«å½¹ç«‹ã¡ã¾ã™ã€‚

Prisma Migrateã‚‚ã‚·ãƒ¼ãƒ‰ã¨ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ‰‹é †ã«å¾“ã£ã¦ã„ã‚Œã°ã€é–‹ç™ºãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã¨ãã«**è‡ªå‹•çš„**ã«ã‚·ãƒ¼ãƒ‰ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

Prisma MigrateãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã€ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã‚·ãƒŠãƒªã‚ªã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

  * `prisma migrate reset` CLIã‚³ãƒãƒ³ãƒ‰ã‚’**æ‰‹å‹•ã§**å®Ÿè¡Œã—ãŸå ´åˆã€‚
  * `prisma migrate dev` ã®ä½¿ç”¨ã«é–¢é€£ã—ã¦ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã®ç«¶åˆã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®ä¸ä¸€è‡´ã®çµæœã¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒ**å¯¾è©±çš„ã«**ãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸå ´åˆã€‚
  * `prisma migrate dev` ã«ã‚ˆã£ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒ**ä»¥å‰ã¯å­˜åœ¨ã—ãªã‹ã£ãŸãŸã‚**ã«å®Ÿéš›ã«ä½œæˆã•ã‚ŒãŸå ´åˆã€‚

ã‚·ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡Œã‚ãšã« `prisma migrate dev` ã‚„ `prisma migrate reset` ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ã€`--skip-seed` ãƒ•ãƒ©ã‚°ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

-----

## ğŸ“ ã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹

ã“ã“ã§ã¯ã€ã„ãã¤ã‹ã®å…·ä½“çš„ãªã‚·ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã‚Šã€ãã®ã¾ã¾ä½¿ç”¨ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### TypeScript ã¾ãŸã¯ JavaScriptã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚·ãƒ¼ãƒ‰ã™ã‚‹

#### 1\. ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

`seed.ts`ï¼ˆã¾ãŸã¯ `seed.js`ï¼‰ã¨ã„ã†åå‰ã®æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `/prisma` ãƒ•ã‚©ãƒ«ãƒ€ãªã©ã«é…ç½®ã—ã¾ã™ã€‚

#### 2\. ã‚¹ã‚­ãƒ¼ãƒã®ä¾‹

ä»¥ä¸‹ã®Prismaã‚¹ã‚­ãƒ¼ãƒãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚

```prisma
schema.prisma

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String
  posts Post[]
}

model Post {
  id        Int     @id @default(autoincrement())
  title     String
  content   String
  published Boolean
  user      User    @relation(fields: [userId], references: [id])
  userId    Int
}
```

#### 3\. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨˜è¿°

`seed.ts` ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã€Prisma Clientã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€åˆæœŸåŒ–ã—ã€ã„ãã¤ã‹ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript
// seed.ts ã®ä¾‹ (TypeScript)

import { PrismaClient } from '@prisma/client'
const prisma = new PrismaClient()

async function main() {
  const alice = await prisma.user.upsert({
    where: { email: 'alice@prisma.io' },
    update: {},
    create: {
      email: 'alice@prisma.io',
      name: 'Alice',
      posts: {
        create: {
          title: 'Check out Prisma with Next.js',
          content: 'https://www.prisma.io/nextjs',
          published: true,
        },
      },
    },
  })
  // ... Bobã®ãƒ‡ãƒ¼ã‚¿ä½œæˆ ...

  console.log({ alice, bob })
}

main()
  .then(async () => {
    await prisma.$disconnect()
  })
  .catch(async (e) => {
    console.error(e)
    await prisma.$disconnect()
    process.exit(1)
  })
```

#### 4\. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (TypeScriptã®å ´åˆ)

`typescript`, `ts-node`, `@types/node` ã‚’é–‹ç™ºä¾å­˜é–¢ä¿‚ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
npm install -D typescript ts-node @types/node
```

#### 5\. `package.json` ã®è¨­å®š

`package.json` ã« `prisma.seed` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json
// package.json ã®ä¾‹
{
  // ...
  "prisma": {
    "seed": "ts-node prisma/seed.ts"
  },
  // ...
}
```

#### 6\. ã‚·ãƒ¼ãƒ‰ã®å®Ÿè¡Œ

`db seed` CLIã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚·ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```bash
npx prisma db seed
```

### ğŸ—„ï¸ Raw SQLã‚¯ã‚¨ãƒªã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ¼ãƒ‰

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ¼ãƒ‰ã«ã¯ã€**Raw SQLã‚¯ã‚¨ãƒª**ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚

ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã® `.sql` ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ€ãƒ³ãƒ—ãªã©ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€æ¥ç¶šæ–‡å­—åˆ—ã®å‡¦ç†ã‚„ `psql` ã®ã‚ˆã†ãªãƒã‚¤ãƒŠãƒªã¸ã®ä¾å­˜ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€SQLã‚¯ã‚¨ãƒªãŒçŸ­ã„å ´åˆã¯ã€ãã‚Œã‚’ `seed.js` ã‚„ `seed.ts` ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«é…ç½®ã™ã‚‹æ–¹ãŒç°¡å˜ãªå ´åˆãŒå¤šã„ã§ã™ã€‚

`seed.js`ï¼ˆã¾ãŸã¯ `seed.ts`ï¼‰ã«ä»¥ä¸‹ã®é–¢æ•°ã‚’è¿½åŠ ã—ã€`main()` ã®å¾Œã«ãƒã‚§ãƒ¼ãƒ³ï¼ˆé€£çµï¼‰ã—ã¾ã™ã€‚

```javascript
// seed.js ã®ä¾‹ (Raw SQL)

async function rawSql() {
  const result = await prisma.$executeRaw`INSERT INTO "User" ("id", "email", "name") VALUES (3, 'foo@example.com', 'Foo') ON CONFLICT DO NOTHING;`
  console.log({ result })
}

// ...
main()
  .then(rawSql) // ã“ã“ã§rawSqlã‚’ãƒã‚§ãƒ¼ãƒ³
  .then(async () => {
    await prisma.$disconnect()
  })
  // ...
```

### ğŸ’» ä»»æ„ã®è¨€èªã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ¼ãƒ‰ (Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨)

TypeScriptã‚„JavaScriptã«åŠ ãˆã¦ã€Goã‚„ãƒ—ãƒ¬ãƒ¼ãƒ³ãªSQLãªã©ã®**ä»–ã®è¨€èª**ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚·ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã«ã€Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ`seed.sh`ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

**Goã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ä¾‹:**

```bash
# seed.sh
#!/bin/sh
set -ex
# Seeding command
go run ./seed/
```

**psqlã§SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ä¾‹:**

```bash
# seed.sh
#!/bin/sh
set -ex
# Seeding command
psql file.sql
```

ã“ã®å ´åˆã€`package.json` ã® `seed` ã‚³ãƒãƒ³ãƒ‰ã‚’ `sh prisma/seed.sh` ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

### âš™ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®å¼•æ•°ï¼ˆv4.15.0ä»¥é™ï¼‰

`prisma db seed` ã§ã¯ã€ã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã‚’å®šç¾©ã—ã€`prisma db seed` ã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ç’°å¢ƒã”ã¨ã«ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒ¼ãƒ‰ã—ãŸã‚Šã€ä¸€éƒ¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿ã‚’éƒ¨åˆ†çš„ã«ã‚·ãƒ¼ãƒ‰ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã‚’å®šç¾©ã—ãŸã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹:**

```javascript
// seed.js ã®ä¾‹ (å¼•æ•°ã®ãƒ‘ãƒ¼ã‚¹)
import { parseArgs } from 'node:util'

const options = {
  environment: { type: 'string' },
}

async function main() {
  const {
    values: { environment },
  } = parseArgs({ options })

  switch (environment) {
    case 'development':
      /** é–‹ç™ºç’°å¢ƒç”¨ã®ãƒ‡ãƒ¼ã‚¿ */
      break
    case 'test':
      /** ãƒ†ã‚¹ãƒˆç’°å¢ƒç”¨ã®ãƒ‡ãƒ¼ã‚¿ */
      break
    default:
      break
  }
  // ...
}
// ...
```

`prisma db seed` ã‚’ä½¿ç”¨ã—ã¦å¼•æ•°ã‚’æ¸¡ã™ã«ã¯ã€ãƒ‡ãƒªãƒŸã‚¿ (`--`) ã‚’è¿½åŠ ã—ã€ãã®å¾Œã«ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã‚’ç¶šã‘ã¾ã™ã€‚

```bash
npx prisma db seed -- --environment development
```

-----

## ğŸš€ ã•ã‚‰ã«é€²ã‚€

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚·ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã«ã€Prisma ORMã¨çµ±åˆã§ãã‚‹ä»–ã®ãƒ„ãƒ¼ãƒ«ï¼ˆéç¶²ç¾…çš„ãƒªã‚¹ãƒˆï¼‰ã‚‚ã‚ã‚Šã¾ã™ã€‚

  * [Supabase community project](https://supabase.com/docs/guides/auth/managing-user-data)
  * [Replibyte](https://www.replibyte.com/)
