---
title: ORMと永続化レイヤー抽象化の歴史
emoji: 🍵
type: idea
topics: ["ORM"]
published: false
publication_name: "levtech"
---
# これはなに
こんにちは、LT開発部のもりたです。
今回はORMと永続化レイヤー抽象化の歴史をまとめます。みなさんORMは日頃から使っているかと思いますが、ORMがどのような課題意識に対応するために出てきたものなのか俯瞰的に学んだことはないのではないでしょうか。
今回の記事では、ORMを永続化レイヤーの抽象化であると読み替え、より包括的に永続化レイヤーの課題に対して私たちがどんなアプローチをしてきたのか考えます。特に、米国のコンピュータ産業史を通して、どんな時代背景の中でORMが登場し、そして発展してきたのかをまとめます。
面白そうですよね？　ではいきます。

:::details なんで歴史？
## Q: なんで歴史？
価値観を相対化できると面白いからです。
以下はほんとに自分がそう思ってるってだけの与太話なんですが、歴史を学ぶというのは現在の価値観の相対化です。

~~例えば、私は仕事での成功を自分の価値であり、夢を追いかけるのは良いこと、プライベートの時間を使って仕事のために勉強することは良いことだと考えています。ただこの考え方は、第二次世界大戦後の冷戦期にソヴィエトの圧力から労働者への保護をしなくちゃいけなくなってケインズ主義が流行り、しかしソヴィエトがその後弱体化して新自由主義が流行ったその流れでブルーオーシャン戦略が続いたわけですが、そのブルーオーシャンの一つとして選ばれたのが個人の可処分時間であり個人の時間を資本主義に捧げようとする方針が日本でもあり（経済白書）、そのコメントが教育現場に入ってきて、その世代なのでこれが身についている、と読める。こういうことが分かると、現在の価値観って別に絶対じゃないし、自分の知らない前提の上に立っているのだと分かる。（これなんの本だっけ？）~~

つまり、歴史を学ぶことはこれまで背景にすぎず、焦点を当てられなかったものに着目することでフラットに考えたり、思考の枠外にアクセスする、ということ。森田は全てを知りたいので、特定のジャンルについて学び、そのジャンルの地図を埋め尽くして、さらにその外側まで到達したいという欲求があるので、こういうふうに歴史を学ぶのが好きです。
:::

:::details 記事の構成
## 記事の構成
今回の記事の構成は以下の通りです。

- ORMの概要
- 米国産業史
	- 1980s: 機械式計算機
	- 1950s: ソフトウェアの登場
	- 1960s: ソフトウェア危機の時代
	- 1970s: GUI, OOP, OS
	- 番外編: ソフトウェア産業とRDB
	- 1980s~1990s: GUIコンピュータの登場とOOPの商用利用
- ORMの歴史
- これからのORM
:::

# ORMの概要
歴史解説の本編に入る前にいちおうORMの概要を書いておくのですが、ORMとはObject-Relational Mapping^[ORマッパーと呼んだりもします]の略で、オブジェクト指向言語とRDBの橋渡しをする技術のことです。Webフレームワークの中に組み込まれていたり、独立したパッケージとして提供されていたり様々ですが、アプリケーションコード上でORMを呼び出して使うことが一般的です。代表的なものだとRuby on RailsのActive Recordや、TypeScriptのPrismaなどが挙げられます^[他にも無限にあります]。
ORMはOOPっぽい書き方でのRDBのInterfaceを提供することでSQL無しにRDBへアクセス可能になり、また、取得したデータを操作しやすいオブジェクトに入れておいてくれます。

# アメリカのコンピュータ産業史
では、ここからはアメリカのコンピュータ産業史を振り返りながら、ORMの登場までを解説したいと思います。
ORMとはすなわちOとRのMappingなわけですから、当然OOPとRDBの登場が必要です。OOPは1972年のSmalltalk72でアラン・ケイによって提唱され、1995年のJavaで花開き、一方のRDBは1969年にIBMのコッド博士の論文で始まり1982年にOracleがOracle2で初めて商業化しています。初めて商業的に流通したORMは1994年のTopLink for Smalltalkであり、そのTopLinkが1996年にJava向けに移植されたことで広がっています。これは一見、Javaという一般に広く受け入れられたOOP言語の登場を待って初めてOとRが結びついたのだと考えられがちですが、本当にそうでしょうか。ここではもう少し視野を広げ、1880年代から1990年代までのアメリカのコンピュータ産業史ーー特にシステム開発現場の様子を説明することで、別の観点から永続化レイヤー抽象化の歴史を語りたいと思います。
## 1880年代~1940年代
### 機械式計算機の登場
アメリカのコンピュータ産業史を語る上でまず触れておきたいのはその始まりです。現代につながるコンピュータ産業史は1880年代から始まりました。
アメリカは1776年にイギリス帝国から独立しましたが、その約10年後1787年にアメリカ合衆国憲法が制定されます。この合衆国憲法第1条第2節第3項には以下のとおり記述があります。

> 下院議員及び直接税は、合衆国に加入する各州の人口に応じて、これを各州に配分する。人口の実地調査は、第1回合衆国議会の開会から3年以内に、以後は10年ごとに、法律の定める方法により行う

この憲法によって、人口の実地調査--つまり国勢調査が、1790年に行われ、以降10年ごとに実施されました。徴兵・徴税のために領地に住む住民の動態を調査することは古代からさまざまな国が行ってきましたが、ここで面白いのはその目的が州ごとに選出される議員数を決めるために国勢調査が行われた点です。
この国勢調査ですが、時代が下るにつれ変化します。まず当初の「人間の数を知るため」という目的が拡張されより複雑なデータを政策に反映させるためのものになります。そのため当初調査項目が3項目のみだったのに対して、1890年の調査では6項目に増加し、人種分類も2種類から7種類になりました^[『国勢調査の文化人類学』青柳真智子編]。そして何よりアメリカの人口が約280万人から6268万人へと増加しました。
このような規模の変化により、アメリカ国勢調査は困難に直面します。1880年の調査では集計作業だけで7年の年月を要しました。さらに当時のアメリカは移民流入の激しい時代であり、次回1890年の調査で集計作業に10年以上の時間が必要であることは確実視されていました。
そういった事態の回避のため、アメリカ政府が解決策を募集し、それに応える形で登場したのがハーマン・ホレリスによるリレー方式の電動作表記（タビュレーター）です。
この発明に端を発する機械式計算機はプログラミング可能な電気式計算機が登場し、商業的に成立する1960年代まで、デスクトップ計算機市場において支配的でした。

### 機械式計算機の概要と"ハードな"システム
この機械式計算機はドル紙幣と同じサイズのパンチカードを使い、穿孔された穴を電気的に読み取る仕組みでした。時代にもよりますが、大体以下の構成です^[木暮仁「パンチカードシステムの歴史」https://www.kogures.com/hitoshi/history/punch-card/index.html]: 。

1. **カード穿孔機（punch）**：タイプライターの印字部を穿孔機構にしたもの
2. **カード分類機（sorter）**：カードを特定の条件で分類する機械
3. **カード照合機（collator）**：ソート確認や条件抽出を行う機械
4. **作表機（tabulator）**：集計計算と印刷を行う中核機械
5. **合計穿孔機（summary punch）**：計算結果を新しいカードに穿孔

ではプログラミング可能な電気式計算機が出てくるまで、オフィスの業務システムはどのように動いていたのでしょうか。当時パンチカード式集計装置を積極的に導入していた保険ビジネスの業務システムを例にとって考えてみましょう。^[
『[Co-evolution of Information-Processing Technology and Use： Interaction between the Life Insurance and Tabulating Industries](https://www.cambridge.org/core/journals/business-history-review/article/coevolution-of-informationprocessing-technology-and-use-interaction-between-the-life-insurance-and-tabulating-industries/F46C6BE7A6F6A46F1DC8BECB9DD5CFBA)』[JoAnne Yates](https://www.cambridge.org/core/search?filters%5BauthorTerms%5D=JoAnne%20Yates&eventCode=SE-AU) めっちゃ面白い論文です]

- この時代は大きく三つに分けられる。初期、印刷技術の導入、アルファベットソート
- 1910年までの導入期
	- 初期は本当に集計ができるだけであり、かつどのような集計をするのかは配線によって制御されていた。また業務要件の変更には都度ハードレベルで機械を入れ替えなければならなかった。また、印刷機能が存在せず、集計結果はアナログに伝達されていたため、そこでミスが発生しうる状態だった
- 1910年代〜1920年代前半
	- 配線での集計方法の変更がプラグボードシステムに変わり、システムの柔軟性が向上した。自動制御が入り計算の正確性が上がった、集計結果をそのまま印刷できるようになった
- 1920年代中盤〜1930年代前半
	- アルファベットでのソート等が可能になった
	- が、メトロポリタン生命保険（メットライフ生命）はピアース社のアルファベット集計システムに100万ドル以上投資したが、一度も完全に設置されることなく終わった


このように、業務に追いついたシステムを作るということは特注の機械を作ることであり、システムはハードウェアによるものでした。

http://ccs.mit.edu/papers/CCSWP153.html


重要なのはまだこの時代、業務を変えようとした時にはユーザ主導な技術革新が必要であり、アジャイルなシステム変更はできなかった。また、技術革新が不要な業務領域であってもはハードウェアの上で動いているってこと。動的じゃない。
### ホレリス作表機のその後
ホレリスは1890年の国勢調査で見事に成果を上げ、タビュレーティング・マシーン社を立ち上げます。その後1911年に3社合併し、CTR社と名前を変え、さらに1924年に改称してInternational Buisiness Machines社となりました。この会社は1990年ごろまでアメリカのコンピュータ産業で圧倒的な地位を保ち、現在も大企業として存在しています。皆さんご存知のIBM社です。

## 1950年代~1960年代
1940年代までのシステムがハードなシステムでした。集計方法を変えるには配線を変えるしかなく、時にはハードウェアの変更を伴うこともありました。それに対して、1950~1960年代はプログラミングが登場した時代でした。ここでは、オフィスのハードウェアであった計算機が、どのように現代につながるプログラミング可能なコンピュータとなり、システム開発という概念が生まれたのかについて解説します。

### プログラミングの登場
この時代の最も大きな出来事は、プログラミング可能なコンピュータの登場です。
完全電子式コンピュータの始まりは第二次世界大戦の弾道計算に使いたいという、高速な計算ニーズからでした。それを受けて、1945年に、終戦後にENIACが完成します。それまでの計算機がなんらかの物理的な機構を必要としていたのに対して、ENIACは完全電子式であり、高速な計算が可能でした。
ただ、ENIACはまだ計算内容を変更したい場合は配線の組み替えによってそれを実現していました。その点をプログラミング内蔵方式によって改善したのがフォン・ノイマンです。彼は1945年に「First Draft of a Report on the EDVAC」という論考を発表し、この中でプログラミング内蔵方式や、コンピュータの五大要素が定義されています。この理論は1949年のEDSACで実現され、さらに商業化したのが1951年のUNIVACです。

さて、フォン・ノイマンにより、計算方法の指定に配線の物理的な組み替えが必要なくなりましたが、この時点ではまだバイナリを直接コンソールスイッチによって打ち込む方式でした。これに対して、EDSACプロジェクトのリーダーであるモーリス・ウィルクスは部下であり優秀な大学院生であったデビット・ホイーラーに命じてアセンブリをバイナリに変換するイニシャル・オーダーを作成させた。
さらに、1953年からはIBMのジョン・バッカスらがFORTRANの開発をスタートし、1957年に完成させている。
### ソフトウェア産業の成立
プログラミング可能なコンピュータが登場したことで、ソフトウェア産業が誕生しました。ソフトウェア産業の最初期は冷戦期の軍需、および宇宙開発資金によって支えられました。

- プログラミング可能なコンピュータの登場
	- プログラミングというものが生まれたが、まだソフトウェア産業にはなってない
		- 1950年代ではまだソフトウェアはコンピュータの付属品でしかなく、無償でコンピュータに同梱されていた。ソフトウェア開発の部署は販売部門のいちセクションでしかなかったほどだった。
- それを変えたのが、戦後の冷戦、および冷戦の延長にある宇宙開発だった
	- まず、1949年にソヴィエトが北極海るーとで核爆弾を投下できると宣言したため、アメリカは急遽、防空システムを作成する必要に追われた。それによって開発されたのがSAGE防空システムである。またその後の宇宙開発では、ロケット開発のニーズがコンピュータをより小さく、そして大容量にしていった
	- 一方、民間ではIBMがアメリカン・エアライン社のシステムであるSABREを開発した
	- このようなシステム開発の中から、ランド・コーポレーションなどソフトウェア開発を専門とするソフトウェア・コントラクターが誕生したり、IBMなどのコンピュータ・メーカーがソフトウェアを作り出した。
- 1962.7.22に金星探査用ロケットのマリナー１号が事故を起こした
	- System/360とOS/360
		- 規格の統一されていなかった7系統のコンピュータを統一し、アップグレードしてもソフトウェアはそのまま使えるようにした
		- しかしOS/360の開発は一年遅延し、4倍のコスト、多くのエンジニアがやめた
	- ソフトウェア危機
		- 1968年に宣言
	- ソフトウェア工学の芽生え
		- 最初は1951年にケンブリッジグループのデビット・ホイーラーらが『ディジタル・コンピュータのプログラムのつくりかた』をまとめている
		- OS/360にはブルックスが参加し、『人月の神話』を著した
		- 構造化プログラミング
- まとめ
	- ソフトウェアの時代が始まり、ソフトウェア危機、ソフトウェア工学の時代
## 1970年代〜1980年代
- 1960年代まではソフトウェアという概念が誕生した時代でした。それに対して1970〜1980年代は、本稿の主要なキーワードであるOOPとRDBが登場する時代です。ここからはOOPとRDBの歴史および実際のシステムでの利用のされ方を整理することで、なぜその両者がMRMに結実しなかったのかを整理します。


#### 考える
- いや、OOPの歴史とかを読んでみると、81年に一般に知られて、86年にOOPSLAができて、89年にはIBMもそこに追従してて、やっぱ産業界全体としてOOPは結構受け入れられつつあったんだろうな
	- https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91
- 単純にまだ出てなかっただけ、OOPとRDBの開発がメインになってきて、橋渡しの技術が必要になって出てきただけ
	- 開発の速度が早まったとかではない、事業の速度に合わせるためにORMがいるわけではなさそう
- 俺としては、事業の動きに柔軟に追従するオブジェクトと、追従しないRDBという構図があって、ORMって単なる橋渡しじゃなくてそこをやってくれてるよね？　ということが言いたいんだよな
	- いやORMも結局、テーブルを定義してOOPっぽくRDBにアクセスできるようにしてくれてるだけで、
### OOPとSmalltalk
- OOP
	- OOPという単語はSmalltalk72でアラン・ケイが発言している
	- Smalltalkは単純な言語処理系ではなく、オブジェクトベースなソフトウェアOSであったといえる
	- アランケイはダイナブックにつながる構想を博論でだして、XeroxのPARCでGUIの研究を進めた
	- その中でGUIをもった開発環境として出てきたのがSmalltalkである
- OSの補足
	- もともとOSはバッチ処理とかのためにとかのためにあったけど、タイムシェアリングで大きく伸びた
	- タイムシェアリングの機械であるであるなんとかをもじったUNIXがこのころ出てきて、大学で導入されていく

### RDBの歴史
- 1959年にデータバンク
- 1969にIBMのコッド博士がRDB
- 1982年にOracle2が登場し、DB2が1984年にでてくる
	- それまでのIBMの階層型DBはまだいた

### 当時の開発環境
- COBOLとRDB
	- Embedded SQLの登場

# 1990年代
- OOPの導入
- GUIがおおうけする
	- 新領域ではねる


