---
title: TiDB Cloudのモニタリングはこんなふう！ TiDB Cloud Clinicを触ってみた感想
emoji: 🐟
type: Tech
topics:
  - データベース
  - TiDB
published: true
publication_name: levtech
published_at: 2026-02-06 11:45
---
## これはなに
こんにちは、レバテック開発部のもりたです。
最近、担当システムのデータベースがAWS AuroraからTiDB Cloudに切り替わりました。やったぜ！！🥳🥳🥳　とテンションが上がったのも束の間、スロークエリが頻発したりなんだか騒がしく......。こんな時、AWS AuroraではDatabase Insightなどのモニタリング/パフォーマンスツールがあったのですが、TiDBでどうやったらいいの〜〜！？！？！😭😭😭　ということで、調べてみました。

また今回はTiDBへの移行を検討しているAWS Auroraユーザの方にもわかりやすいよう、AuroraのモニタリングツールであるDatabase Insights^[Database Insightsの前身がPerformance Insights。2025年に後継として発表され、有料版も出ました]と適宜比較しながら説明していきます。（以下はもりたが昔書いたAuroraのモニタリングに関する記事です。読んでね）
https://zenn.dev/levtech/articles/08e2830ba2e069

## 概要
### TiDB Cloudのモニタリングには２つの方法
まず、TiDB Cloudのモニタリング方法には２つやり方があります。
１つ目がTiDB Cloudの組み込みメトリクスです。AWSにおけるCloudWatchのようなもので、基本的なよくある（けれど分散DBらしい）メトリクスが数種類並ぶ、という感じです。
２つ目がTiDB Cloud Clinicと呼ばれるツール。こちらは色々できて面白く、AWS AuroraにおけるDatabase Insights的な立ち位置のツールになります。
組み込みメトリクスで見れる情報は基本的にTiDB Cloud Clinicでも確認できます。そのため、今回はTiDB Cloud Clinicに絞って見ていこうと思います。

### TiDB Cloud Clinicは４つの機能を持つ
そのTiDB Cloud Clinicですが、具体的には以下４つの機能を持っています。

- メトリクス
- スロークエリ
- TOP SQL
- ベンチマークレポート

続けて、上記の機能を順に紹介していきます。

## TiDB Cloud Clinicを触ってみよう！
![](https://storage.googleapis.com/zenn-user-upload/7a2060a73b05-20260203.png)
*トップ画面はこちら。ざっくりメトリクスと４つの機能が出ています。適宜ぼやかしつつお見せしていきます*

### メトリクス
![](https://storage.googleapis.com/zenn-user-upload/0db622f00551-20260203.png)
*トップページでメトリクスを選択すると出てくるポップアップ。メトリクスの種類が選べます。なおdefaultとなっている箇所は利用しているTiDBのバージョンを選択する必要があります。*

まずはメトリクスです。これはその通りメトリクスで、さまざまな指標を見ることができます。[公式ドキュメント](https://docs.pingcap.com/tidbcloud/tidb-cloud-clinic/#monitor-advanced-metrics)では見れる指標の種類が紹介されていますが、パッとタイトルを読むだけだとどんなメトリクスが確認できるかわかりません。以下にもりたが内容を確認して予測したメトリクスの概要を記載します。

| 種別                    | 中身                                                               | 備考              |
| --------------------- | ---------------------------------------------------------------- | --------------- |
| Backup & Import       | 名前の通りバックアップとインポート                                                | どう使うのかはあまりわからない |
| DM-Professional       | リレーログ等が入っていたのでレプリケーション関連っぽい                                      |                 |
| DM-Standard           | 同上。プロフェッショナルとスタンダードの違いはあまりわからず                                   |                 |
| Lightning             | CPU, memory, クエリに使った時間やインポートスピードなど。どういうまとまりなのかは不明                |                 |
| Performance-Overview  | 見慣れたパフォーマンス指標に加えて、TiDBやTiKVなどのノードに関する指標も載っている                    | 見てて面白そう         |
| TiCDC-Summary         | TiCDCはTiDB→外部のMySQL互換DBのレプリケーションツール。それに関する指標群                    |                 |
| TiDB                  | 230個くらいの指標が並んでいるが、おそらくTiDBノードに関するもの                              |                 |
| TiDB-Resource-Control | Resource Unitと呼ばれるTiDBにおけるインスタンスのパワーみたいなものを見れるところだと思っています        |                 |
| TiFlash-Summary       | TiFlashは分析用クエリに強いデータストレージ。それに関する指標                               |                 |
| TiKV-Details          | TiKVは業務用クエリに強いデータストレージ。それに関する指標                               |                 |
| TiProxy-Summary       | 公式ドキュメントには存在するが、私の環境には存在しないもの。TiProxyはTiDBノードの手前にあるコネクションを管理する機構 |                 |
| User-Node-Info        | Disk I/Opsなどの物理的なところっぽい                                          |                 |

一応整理してみましたが、メトリクスの数が多く、TiDBの内部構造に精通していないと理解が難しいものもあり、使いこなすのは簡単ではなさそうです。メトリクスは問題の検知をする上で最も重要なため、次のような公式から提供されているページを活用すると良さそうです。

https://docs.pingcap.com/ja/tidb/stable/grafana-overview-dashboard/

なお、このダッシュボードはGrafanaで管理されているようです。

### スロークエリ
![](https://storage.googleapis.com/zenn-user-upload/5f3c61342260-20260203.png)
こちらがスロークエリ^[対象は300ms以上で固定]の画面。画面上部左側に**Top SlowQueries**と**Slow Query Logs**と書いてある通り、タブ表示になっています^[二週間くらい気が付かなかった]。

上記画像はTop SlowQueriesの画面で、弊社環境では最大２週間を遡ることができ、どんなスロークエリが出ていたか確認できました。クエリごとに表示される項目はpt-query-digestと同じ^[たぶん]であり、MySQLでスロークエリを見ていた人間にとってはとっつきやすいものでした。AWS Auroraではこのダイジェスト情報は自分で出さないといけなかったため、地味に助かると思います。

![](https://storage.googleapis.com/zenn-user-upload/f15a27576532-20260205.png)

続いて上記がSlow Query Logsで、Digestになる前のログ一覧です。
画面右上に小さくColumnsと書いてあるのですが、ここを開くと表示するカラムを選択することができます。これによってTiDB特有のさまざまな情報を含め表示することができ、かなり面白いです。分析が捗りそうですね。

### TOP SQL
![](https://storage.googleapis.com/zenn-user-upload/5b8d52044855-20260205.png)
AWS AuroraのDatabase InsightsにあるTOP SQLと似たものです。表示はTiDBノードとTiKVノードごとに表示でき、２週間強遡ることができます^[これも弊社環境]。
Database Insightsでは負荷の種類や程度も見ることができましたが、こちらは単純にどのクエリがどれくらいの時間流れているかを出すだけです。そのため、Database InsightsのAASのような、パッと見て負荷がわかる状態ではありません。このページを見るだけで問題があるかどうかを知ることはできないようです。

### ベンチマークレポート
![](https://storage.googleapis.com/zenn-user-upload/42ce368b7b4c-20260206.png)
こちらはAWS Auroraには全くない機能で、その名の通りベンチマークのレポートを出してくれます。過去７日間^[これも弊社環境]を遡ることができ、期間を指定することで詳細なレポートを出力可能です。
障害が発生した際に問題がどこにあったのかなど調査に使える...？　と思いつつ、疑問なのはこのレポートがどのように出力されるのかという問題。具体的にはこのベンチマークレポートを出す際にDBに負荷がかかっているのか？　が気になりました。この点が分からないと気軽に出力できないので、公式ドキュメントなどで教えて欲しいなと思っています。

### 全体の感想

ほんまに恐れ多いんですが、まだちょっと使うのに知識と慣れがいりそうだなと感じました^[ほんまに恐れ多い。土下座しながら書いてます]。
これは自分の理解なんですが、こういったメトリクスのツールは問題が起きたあとに使うというよりは、長期的な傾向や過去のデータをもとに問題を予期するというのが一番求められることになると思います。その点、まだClinicはDatabase Insightsなどと比べて内部構造などの専門的な知識が求められる印象がありました。ただ、TiDBは現在もかなり開発が盛んみたいなので、早晩使いやすいダッシュボードが用意されるのではないかと期待しています。
また、ベンチマークレポートはかなりテンションが上がりました。これを定期的に実行して問題がないかみていくのも良いかもしれません。新しい時代のスロークエリダイジェストって感じですね。

## 終わりに
TiDB Cloud Clinicの調査、楽しかったです！！
まだまだ情報も少ないので、こうやって素人の感想がたくさん集まってくれるといいなと思いました。